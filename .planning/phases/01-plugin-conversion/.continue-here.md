---
phase: 01-plugin-conversion
task: 4
total_tasks: 8
status: in_progress
last_updated: 2026-01-27T12:00:00
---

<current_state>
Converting deng-toolkit from symlink-based installation to proper Claude Code Plugin SDK-compliant plugin. Completed Phase 1 tasks (plugin structure). Now ready to start Phase 2 (MCP server).
</current_state>

<completed_work>
- Task #2: Create .claude-plugin/plugin.json manifest - DONE
  - Created `.claude-plugin/plugin.json` with full component declarations
  - Includes 6 commands, hooks reference, MCP server reference

- Task #4: Convert skills to commands - DONE
  - Created `commands/` directory with 6 command files:
    - deng-catalog-refresh.md
    - deng-find-data.md
    - deng-build-ontology.md
    - deng-analyze-procedures.md
    - deng-catalog-status.md (new)
    - deng-catalog-sync.md (new for team sharing)
  - All paths use `${CLAUDE_PLUGIN_ROOT}` variable

- Task #3: Create hooks/hooks.json - DONE
  - Created `hooks/hooks.json` with PostToolUse hooks
  - Created helper scripts in `hooks/scripts/`:
    - catalog-updated.sh
    - ontology-updated.sh
  - Made scripts executable
</completed_work>

<remaining_work>
- Task #1: Create .mcp.json configuration for catalog server
  - Define MCP server config pointing to servers/catalog-mcp/

- Task #8: Create MCP server at servers/catalog-mcp/ (blocked by #1)
  - Create server.py with 5 tools: search_catalog, get_table_details, find_join_paths, get_catalog_status, query_ontology
  - Port logic from existing catalog_query.py
  - Create pyproject.toml with dependencies

- Task #7: Initialize ~/.ds_catalog/ as git repository for team sharing
  - The /deng-catalog-sync command is written, need to document team onboarding

- Task #6: Update setup.sh for plugin-style installation (blocked by #8)
  - Convert from symlink-based to proper plugin installation

- Task #5: Update README.md with new structure documentation (blocked by #8, #6)
  - Document new plugin structure, MCP tools, commands
</remaining_work>

<decisions_made>
- Using `${CLAUDE_PLUGIN_ROOT}` for all paths in commands (plugin SDK standard)
- Created 6 commands instead of 5 skills (added deng-catalog-status and deng-catalog-sync)
- Hook scripts are simple shell scripts that provide helpful follow-up suggestions
- Keeping existing scripts/ directory intact - commands call into them
</decisions_made>

<blockers>
None currently. Next task (#1 - .mcp.json) is unblocked.
</blockers>

<context>
The plan is to convert deng-toolkit to a proper Claude Code Plugin. This is part of a larger effort where:
1. deng-toolkit = data catalog plugin (this work)
2. ds-workflow = separate orchestration plugin (future work, out of scope)

The MCP server is the most complex remaining task - it needs to expose 5 tools that wrap the existing catalog_query.py functionality. The server should use the `mcp` Python package.

Current file structure created:
```
~/.deng-toolkit/
├── .claude-plugin/
│   └── plugin.json          ✓ Created
├── commands/                 ✓ Created (6 files)
│   ├── deng-catalog-refresh.md
│   ├── deng-find-data.md
│   ├── deng-build-ontology.md
│   ├── deng-analyze-procedures.md
│   ├── deng-catalog-status.md
│   └── deng-catalog-sync.md
├── hooks/                    ✓ Created
│   ├── hooks.json
│   └── scripts/
│       ├── catalog-updated.sh
│       └── ontology-updated.sh
├── .mcp.json                 ○ Next to create
├── servers/                  ○ Next to create
│   └── catalog-mcp/
│       ├── server.py
│       ├── pyproject.toml
│       └── README.md
├── scripts/                  (existing, unchanged)
├── skills/                   (existing, will be deprecated)
└── ...
```
</context>

<next_action>
Start with Task #1: Create `.mcp.json` at plugin root that configures the MCP server. Then proceed to Task #8 to implement the actual MCP server at `servers/catalog-mcp/server.py`.

The .mcp.json should look something like:
```json
{
  "mcpServers": {
    "deng-catalog": {
      "command": "uv",
      "args": ["run", "--directory", "${CLAUDE_PLUGIN_ROOT}/servers/catalog-mcp", "server.py"]
    }
  }
}
```
</next_action>
